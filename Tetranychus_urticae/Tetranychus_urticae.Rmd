---
title: "Temperature dependent dispersal: A distributed experiment"
author: "Anna-Gaëlle De Groote, Siebe van Wunnik, Dries Bonte"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r instructions, echo = F, warning = F}

# INSTRUCTIONS FOR RESEARCHERS

# Here, you'll find instructions and information to fill out about your species. Once you have finished following the instructions, go to the render_script in your species folder and run the code - this will automatically knit a word document to the shared Knitted_Markdowns folder. You don't need to make any changes to the analysis outside of this code chunk, but feel free to do so if it's appropriate for your species. If you make substantive changes to either of the models, please flag it for Celina.

# Note: Do not try to "run all" within R, you will get an error. Knitting the document from the RStudio menu will only save it to your species folder, not add it to the shared folder, so please use render_script.

# 0. Add names of researchers who worked on this species to author list above

# 1. Before starting, make sure your data files are named:
# Phase1_fitness_Genus.species.csv
# Phase2_dispersal_Genus.species.csv



## code below assumes .csv format (only in the code chunk named 'loaddata'; You can change this if you would rather not use .csv)


# 2. Install any missing libraries from the list below:
library(tidyverse)
library(lme4)
library(ggplot2)
library(emmeans)
library(DHARMa)
library(glmmTMB)

# 3. Fill out information about your species below

Genus = "Tetranychus"
species = "urticae"
fitness.proxy = "Population growth, r"
low.temp = 24 #value of low temperature treatment in Celsius
opt.temp = 30 #value of optimal temperature treatment in Celsius
high.temp = 36 #value of high temperature treatment in Celsius


# 4. Check that the data files have the following headers (order of columns is not important):

## phase1 : Temp.treatment (levels = low, opt, high), Temp.value (in degrees C), random effects (name as appropriate), Fitness
### It's important to give the column of the fitness variable the header "Fitness". You have already provided a description of the fitness proxy which will be used in the knitted document.

## phase 2:

### If your phase 2 data are formatted with mesocosms as rows and number of dispersers/number of non-dispersers as columns, then these headers:
#### Temp.treatment (levels = low, opt, high), Temp.value (in degrees C), random effects (name as appropriate), Num.disp, Num.nondisp (or alternatively, Num.disp and total N)

### If your phase 2 data are formatted with individuals as rows and a dispersed column (0s and 1s) giving dispersal status for each individual, then these headers:
#### Temp.treatment (levels = low, opt, high), Temp.value (in degrees C), random effects (name as appropriate), Dispersed (0/1)

# note that the datasets can also include fixed effects and phenotypes, as appropriate for your study


# 5. Type of fitness data

## Answer questions below about the fitness proxy

### Is your fitness variable binary? (choose one)
fitness.binary = FALSE

### Is the fitness variable continuous normal (without transformation)? (choose one)
fitness.normal = FALSE

### Is the fitness variable normal after transformation? (choose one; choose NA if you said "TRUE" to either question above)
fitness.transformed.normal = TRUE

## If fitness variable is continuous normal AFTER transformation, choose transformation used (just write it in if not on this list):

transform.description <- "sqrt" # leave as-is if not applicable
fitness.transformation.function <- function(x) {return (sqrt(x))} # give transformation formula here; replace XYZ with transformation e.g., sqrt(x) or log(x + 1), etc., where x will be Fitness, below

## note: if fitness (or transformed fitness) does not have a binomial or normal distribution, check in with Celina.


# 6. Structure of dispersal data

## Is there overdispersion in the dispersal data? If you do not yet know, choose FALSE and this will be dealt with in step 12.

overdispersion = TRUE


# 7. Dealing with mortality in dispersal assay

## note on mortality: everyone will deal with mortality during the dispersal assay in a slightly different way. If individuals are rows in your dataset, you should have a row that indicates "Survived" (Y/N) through the entire experiment. In this case, set filter.dead = TRUE below. If mesocosms are rows in your dataset, you may have a column indicating the number of individuals that died. In this case, dead individuals can be excluded directly in the dispersal formula (e.g., (Num.disp, TotalN-(Num.disp+Num.dead))).

## Make sure to describe how you dealt with mortality in the methods below.

## If you are unsure how to handle mortality in your dataset, check with Celina.

## Do rows represent individuals in the dataset and are there dead individuals that should be removed from the dispersal data?

filter.dead = FALSE # choose NA if this does not apply to your species

## Also filter out males!



# 8. Model formulae

## Formula for fitness: (fill in as appropriate)
fitness.formula.zero <- zero ~ Temp.treatment + population + (1|dispersion_id)
fitness.formula.pos <- Fitness ~ Temp.treatment + population + (1|dispersion_id)

### notes:
#### TRANSFORM FITNESS VARIABLE (if needed) *WITHIN* THE FORMULA; doing it within the formula is important for contrasts below  
#### other.fixed.effects does not apply to every species; include as appropriate; fixed effects should be standardized
#### include as many random effects as appropriate
#### Fitness can be normal or binary, including 0s and 1s or cbind(number.survived, number.dead)

### If fitness is binary: (ignore if fitness is not binary)

### What do Fitness = 0 and Fitness = 1 mean?

Fit0 <- "Died/Survived" # or fill in other
Fit1 <- "Died/Survived" # or fill in other

## Formula for dispersal: (fill in as appropriate)
  
dispersal.formula.zero <- zero ~ Temp.treatment + population + (1|dispersion_id)
dispersal.formula.pos <- cbind(Num.disp, Num.res) ~ Temp.treatment + population + (1|dispersion_id)
### notes
#### other.fixed.effects does not apply to every species; include as appropriate; fixed effects should be standardized
#### include as many random effects as appropriate
#### Num.disp/Num.nondisp can be replaced with column "Dispersed" with values 0 and 1, if individuals are rows in your dataset
#### remember to deal with mortality directly in dispersal formula if appropriate


# 9. Moderators

## We are collecting data on all proposed moderators; we will use a subset of these in the analysis
## choose option on right hand side
## see description of moderators and levels in README.md in project repo

taxonomic.group <- "arthropod"
rearing.environment <- "commonT"
comp.strength <- "low"
source <- "lab" # lab population or field caught
habitat <- "terrestrial"
Tvariation <- "heterogenous"
species.body.size <- 0.5 # mean body length in mm
passive.dispersal <- "Yes"
inbred <- "inbred line"
disp.assay.duration <- 1 # order of magnitude for dispersal assay duration / generation time, i.e., approximate number of generations the dispersal assay lasted
fitness.proxy.type <- "r"

# 10. Fill out methods information in text below.

```

# Supplementary methods for *`r (print(paste(Genus, species)))`*

## Study organism

Tetranychus urticae:

- Beis C 
- Led-5 
- Lux 
- Mar 

#Provide basic life history information (aquatic/terrestrial, mode of dispersal, lifespan, etc.).  

Terrestrial plant-feeding Acari,  cosmopolitan distribution, polyphageous, reproduce through arrhenotoky (haplodiploids), capable of diapause during winter, capable of both active and passive dispersal, lifespan between 2 and 4 weeks, capable of producing approximately 70 eggs during a lifetime.

#Briefly describe what is known about the temperature range the species experiences (geographic range, seasonality, type of habitat, etc.) in its natural system or the history of the conditions it has experienced in the lab.  

Tetranychus urticae is a cosmopolitan species found worldwide in temperate, subtropical, and tropical regions. In its natural environment, it is most active during the warmer months, with populations typically peaking in spring and summer. It inhabits plant surfaces, especially the undersides of leaves, and is commonly associated with crops, ornamentals, and weeds. The species thrives in temperatures ranging from approximately 20–30°C, with optimal development occurring around 25–28°C. While it can tolerate brief periods of higher temperatures, extreme heat above 40°C or prolonged exposure to cold below 10°C significantly reduces survival and reproduction. In the lab, the species is maintained within its optimal temperature range on bean.


#How were organisms sourced?  

Field caught: line, location, original host plant

- Beis C: Brugge, Belgium. Solomon's seal
- Led-5: Ghent, Belgium. Strawberry
- Lux: Mullerthal, Luxembourg. Mallow
- Mar: Paris, France. Greater celandine


#How were individuals/populations treated before the experiment?  

- The mites were made isofemale lines, after which they were maintained under constant conditions as a stock. Food was ad libitum, temperature was kept at 24°C, and constant light.
When were the lines collected:

- Beis C: 2020
- Led-5: 2023
- Lux: 2023
- Mar: 2023

#Were specific individuals/phenotypes/stages selected for the experiment?  

No Wolbacchia present (capable of skewing sex-ratio)

## Study design

### Temperature treatments

- Tcold: 24°C; Sufficiently cold to be suboptimal, while still above diapause temperature and mites will still show activity and movement.
- Topt: 30°C; Optimal temperature for spider mites, as here their generation time and number of offspring increases.
- Thot: 36°C; Sufficiently hot to affect the spider mites, while not causing complete mortality.

### Phase 1: Fitness assay

Fitness proxy: malthusian fitness = number of viable female offspring produced by one female. 

  
#-	Physical details about the experimental setup including size/shape/volume of experimental arenas, substrate/medium of experimental arenas.  

- Adult females were kept in incubator at treatment temperature for 24 hours, after which they were placed on a bean leaf. Here, they were allowed to lay eggs for 24 hours. These eggs were controlled daily to check for hatching, and female hatched offspring were placed on a dispersal plate (2 patches). Here, they were allowed to lay eggs for four days on either of the bean leaf discs. These eggs were checked daily for hatching success and sex determination of the offspring. 

-	Replicates  
    - Three replication rounds
    - Variable number of replicates per adult female: dependent on number of eggs laid
    - Blocked on replication rounds
-	Food was available ad libitum in the form of bean leaves. 
- Starting density of one mite.  
-	Fitness assay lasted until all eggs were hatched or visible defect
-	Only females were used for the fitness assay 
- Daily fecundity was estimated by dividing the number of hatched female offspring by the developmental time. 

### Phase 2: Dispersal assay

-	Adult females were kept in incubator at treatment temperature for 24 hours, after which they were placed on a bean leaf. Here, they were allowed to lay eggs for 24 hours. These eggs were controlled daily to check for hatching, and female hatched offspring were placed on a dispersal plate (2 patches). Here, they were allowed to lay eggs for four days on either of the bean leaf discs. These eggs were checked daily for hatching success and sex determination of the offspring. 

-	Replicates  
    - Three replication rounds
    - Variable number of replicates per adult female: dependent on number of eggs laid
    - Blocked on replication rounds
-	Food was available ad libitum in the form of bean leaves. 
- Starting density of one mite.
-	Duration of dispersal assay including:  
    - Parent already experienced treatment temperature  
    - No acclimation period
    - Dispersal assay lasted four days
- Only females were used for the dispersal assay 
- Dispersal was measured by calculating the number of eggs laid on the second patch compared to the total number of eggs laid.
- Individuals used in phase 2 were the same as used in phase 1 
- Provide details on data collection including:  
    -	Daily sampling 
    -	Sampling consisted of checking both patches and counting the number of eggs. 
- Individuals that died during the dispersal assay were excluded from the analysis of dispersal.  



```{r instructions2, echo = F}

# 11. Knit RMarkdown

## Now it is time to knit the RMarkdown document. Open the render_script document in the species folder and run that script (see README.md for additional instructions). It will automatically write the files to the correct folders in the repository. Remember not to 'run all' in the RMarkdown. You will get an error.

# 12. Check diagnostics

## The final section of the output doc will be model diagnostics. Check the output word doc (it will be in the 'Knitted_Markdowns' folder) for any issues and re-run the render_script if necessary after selecting different options in the RMarkdown (e.g., does the fitness variable need to be transformed? Is there overdispersion in the dispersal data?)

## You should also check the word doc for warning messages for the models (e.g., singularity in mixed models). These (if there are any) will print in the knitted doc next to the model results.

## If problems persist, the way the analysis is done may have to be changed (check in with Celina).

## Note that the current default description of the diagnostics is: "There was no evidence for lack of fit for either the fitness or the dispersal model." Change this as needed.


#############

# YOU ARE DONE! NO NEED TO FILL IN OR CHANGE ANYTHING BELOW.

############

```

## Statistical Analysis

```{r loaddata, echo = F}

# Set reading and writing paths; Do not change these paths
reading.path <- ("./")

writing.path <- ("../outputs/")

file_phase1 <- file.path(reading.path, paste0("Phase1_fitness_", Genus, ".", species, ".csv"))
file_phase2 <- file.path(reading.path, paste0("Phase2_dispersal_", Genus, ".", species, ".csv"))

# Load CSVs
d_phase1 <- read.csv2(file_phase1, row.names = NULL, check.names = TRUE, stringsAsFactors = FALSE)
d_phase2 <- read.csv2(file_phase2, row.names = NULL, check.names = TRUE, stringsAsFactors = FALSE)

# load data file
d_phase1 <- read.csv2(
  file.path(reading.path, paste("Phase1_fitness_", Genus, ".", species, ".csv", sep = "")),
  row.names = NULL,
  check.names = TRUE,
  stringsAsFactors = FALSE
)

d_phase2 <- read.csv2(
  file.path(reading.path, paste("Phase2_dispersal_", Genus, ".", species, ".csv", sep = "")),
  row.names = NULL,
  check.names = TRUE,
  stringsAsFactors = FALSE
)



d_phase1 <- within(d_phase1, Temp.treatment <- relevel(as.factor(Temp.treatment), ref = "opt"))
d_phase2 <- within(d_phase2, Temp.treatment <- relevel(as.factor(Temp.treatment), ref = "opt"))

d_phase2 <- d_phase2 %>%
  { if (filter.dead) filter(., Survived == "Y") else . }

```

```{r writedata, echo = F}

# specify fitness and dispersal file names
fitpath <- paste("Phase1_fitness_", Genus, ".", species, ".csv", sep = "")
disppath <- paste("Phase2_dispersal_", Genus, ".", species, ".csv", sep = "")

data_path <- "../raw_data/" #path to save the data is to the raw_data folder

#save copy of final dfs used in this file to the raw_data folder
write.csv(d_phase1, paste(data_path, fitpath, sep = ""), row.names = FALSE)
write.csv(d_phase2, paste(data_path, disppath, sep = ""), row.names = FALSE)


# Convert Fitness to numeric
d_phase1 <- d_phase1[d_phase1$Fitness != "#N/A", ]
d_phase1$Fitness <- gsub(",", ".", d_phase1$Fitness)
d_phase1$Fitness <- as.numeric(d_phase1$Fitness)

```


### Does fitness change with temperature (phase 1)?

`r ifelse(fitness.transformed.normal == TRUE, print(paste(fitness.proxy, " was not normally distributed so we ", transform.description, "-transformed it. The transformed variable followed a normal distribution.", sep = "")), ifelse(fitness.normal == TRUE, print(paste(fitness.proxy, "was normally distributed.")), print(paste("The fitness proxy,", tolower(fitness.proxy), ", was a binary variable."))))`

```{r fitnessnormal, eval = fitness.normal, echo = F, fig.cap = paste("Figure 1. Histogram of fitness (", tolower(fitness.proxy), ") values.")}

# histogram showing fitness proxy was normally distributed
with(d_phase1, hist(Fitness, xlab = fitness.proxy, main = NULL))

```


```{r transformedfitnessnormal, eval = fitness.transformed.normal, echo = F, fig.cap = paste("Figure 1. Histogram of", transform.description, "-transformed", tolower(fitness.proxy), "values.")}

# histogram showing transformed fitness proxy was normally distributed

with(d_phase1, hist(fitness.transformation.function(Fitness), xlab = paste(transform.description, "-transformed ", tolower(fitness.proxy), sep = ""), main = NULL))

```

```{r fitnessplotnormal, eval = fitness.normal | fitness.transformed.normal, echo = F, message = F, fig.cap = paste("Figure 2. Boxplot of fitness (", tolower(fitness.proxy), "), as a function of temperature treatment. low = ", low.temp, "C, opt = ", opt.temp, "C, high = ", high.temp, "C.")}

# plot fitness data

ggplot(d_phase1, aes(x = Temp.treatment, y = Fitness, col = Temp.treatment))+
  geom_boxplot()+
  scale_x_discrete("Temperature treatment", limits = c("low", "opt", "high"))+
  scale_color_manual(values = c("darkgreen", "red", "blue"), guide = "none")+
  theme_classic(base_size = 15)

```

`r ifelse(fitness.binary == T, print(paste("To estimate the effects of temperature (a factor) on fitness we used a generalized linear mixed model with a logit link and", tolower(fitness.proxy), "as the binary response variable. We used the formula:")), paste("To estimate the effects of temperature (a factor) on fitness, we used a linear mixed model with", tolower(fitness.proxy), "as the response variable. We used the formula:"))`  

`r deparse(fitness.formula.pos)`

```{r fitnessmodelnormal, eval = fitness.normal | fitness.transformed.normal, echo = F}

d_phase1$zero <- d_phase1$Fitness == 0

# --- 1. Zero part (logistic) ---
m_fitness_zero <- glmmTMB(
  fitness.formula.zero,
  family = binomial(link="logit"),
  data = d_phase1
)


# ANOVA for zero part
output_fitness_zero_Tempeffect <- drop1(m_fitness_zero, test = "Chisq")

# Summary for zero part
output_fitness_zero_summary <- summary(m_fitness_zero)

# Pairwise comparisons for zero part (odds of producing any offspring)
output_fitness_zero_emmeans <- emmeans(
  m_fitness_zero,
  specs = pairwise ~ Temp.treatment,
  type = "response",       # back-transforms logit to probability
  adjust = "none"
)

output_fitness_zero_contrasts <- output_fitness_zero_emmeans$contrasts %>%
  summary(infer = TRUE)


# --- 2. Positive part (Gamma) ---
d_pos <- subset(d_phase1, Fitness > 0)
m_fitness_pos <- glmmTMB(
  fitness.formula.pos,
  family = Gamma(link="log"),
  data = d_pos
)


# ANOVA for positive part
output_fitness_pos_Tempeffect <- drop1(m_fitness_pos, test = "Chisq")

# Summary for positive part
output_fitness_pos_summary <- summary(m_fitness_pos)

# Pairwise comparisons for positive part
output_fitness_pos_emmeans <- emmeans(
  m_fitness_pos,
  specs = pairwise ~ Temp.treatment,
  type = "response",   # back-transform log-link to mean response
  adjust = "none"
)

output_fitness_pos_contrasts <- output_fitness_pos_emmeans$contrasts %>%
  summary(infer = TRUE)


```


```{r fitnesstablebinary, eval = fitness.binary, echo = F}

fittable <- with(d_phase1, table(Temp.treatment, Fitness))
knitr::kable(fittable, col.names = c(Fit0, Fit1),
 caption = paste("Table 1. Relationship between", tolower(fitness.proxy), "and temperature treatment.")) 


```


```{r fitnessmodelbinary, eval = fitness.binary, echo = F}

# model testing effects of temperature on fitness

m_fitness <- glmer(fitness.formula, family = binomial, data = d_phase1)

# output results for overall model and pairwise comparisons

output_fitness_Tempeffect <- drop1(m_fitness, test = "Chisq")
output_fitness_summary <- summary(m_fitness)
output_fitness_emmeans <- emmeans(m_fitness, specs = pairwise ~ Temp.treatment, type = "response", adjust = "none")
output_fitness_contrasts <- output_fitness_emmeans$contrasts %>%
     summary(infer = TRUE)

```

#### Results for main effect of temperature on fitness for zero part
```{r fitnessresultsmaineffect_zero, echo = F}
# for zero part of fitness
output_fitness_zero_Tempeffect

```

#### Post-hoc pairwise contrasts: differences in fitness between temperature treatments for zero part
```{r fitnessresultscontrasts_zero, echo = F}
# for zero part of fitness
output_fitness_zero_contrasts

```

#### Results for main effect of temperature on fitness for positive part
```{r fitnessresultsmaineffect_pos, echo = F}
# for positive part of fitness
output_fitness_pos_Tempeffect

```

#### Post-hoc pairwise contrasts: differences in fitness between temperature treatments for positive part
```{r fitnessresultscontrasts_pos, echo = F}
# for positive part of fitness
output_fitness_pos_contrasts

```
### Does dispersal change with temperature (phase 2)?

`r ifelse(!overdispersion, print("To estimate the effect of temperature treatment (a factor) on dispersal, we used a generalized linear mixed model with a binomial error structure and a logit link. Dispersal (the number of dispersers vs non-dispersers) was the response variable. We used the formula:"), print("There was evidence of overdispersion in our dispersal data. Therefore, to estimate the effect of temperature treatment (a factor) on dispersal, we used a generalized linear mixed model with a negative binomial error structure. Dispersal (the number of dispersers vs non-dispersers) was the response variable. We used the formula:"))`  

`r deparse(dispersal.formula.pos)`


```{r dispersalmodelbinomial, eval = !overdispersion, echo = F}

# binomial model testing effects of temperature on dispersal

m_dispersal <- glmer(dispersal.formula, family = "binomial", data = d_phase2)

# output results for overall model and pairwise comparisons
output_dispersal_Tempeffect <- drop1(m_dispersal, test = "Chisq")
output_dispersal_summary <- summary(m_dispersal)
output_dispersal_emmeans <- emmeans(m_dispersal, specs = pairwise ~ Temp.treatment, type = "response", adjust = "none")
output_dispersal_contrasts <- output_dispersal_emmeans$contrasts %>%
  summary(infer = TRUE)


```

```{r dispersalmodelnegbinomial, eval = overdispersion, echo = F}

# Convert characters to factors
d_phase2$population <- factor(d_phase2$population)
d_phase2$dispersion_id <- factor(d_phase2$dispersion_id)
d_phase2$Num.res <- d_phase2$total.N - d_phase2$Num.disp
d_phase2$dispersal_occurs <- as.numeric(d_phase2$Num.disp > 0)

d_phase2$zero <- d_phase2$Num.disp == 0

# --- 1. Zero part (logistic) ---
m_disp_zero <- glmmTMB(
  dispersal.formula.zero,
  family = binomial(link="logit"),
  data = d_phase2
)


# ANOVA for zero part
output_disp_zero_Tempeffect <- drop1(m_fitness_zero, test = "Chisq")

# Summary for zero part
output_disp_zero_summary <- summary(m_disp_zero)

# Pairwise comparisons for zero part (odds of producing any offspring)
output_disp_zero_emmeans <- emmeans(
  m_disp_zero,
  specs = pairwise ~ Temp.treatment,
  type = "response",       # back-transforms logit to probability
  adjust = "none"
)

output_disp_zero_contrasts <- output_disp_zero_emmeans$contrasts %>%
  summary(infer = TRUE)


# --- 2. Positive part (Gamma) ---
d_pos_disp <- subset(d_phase2, Num.disp > 0)
m_disp_pos <- glmmTMB(
  dispersal.formula.pos,
  family = binomial,
  data = d_pos_disp
)


# ANOVA for positive part
output_disp_pos_Tempeffect <- drop1(m_disp_pos, test = "Chisq")

# Summary for positive part
output_disp_pos_summary <- summary(m_disp_pos)

# Pairwise comparisons for positive part
output_disp_pos_emmeans <- emmeans(
  m_disp_pos,
  specs = pairwise ~ Temp.treatment,
  type = "response",   # back-transform log-link to mean response
  adjust = "none"
)

output_disp_pos_contrasts <- output_disp_pos_emmeans$contrasts %>%
  summary(infer = TRUE)

```


```{r dispersalplot, echo = F, warning = F, fig.cap = paste("Figure 1. Dispersal as a function of temperature treatment. low = ", low.temp, "C, opt = ", opt.temp, "C, high = ", high.temp, "C. Error bars represent 95% confidence intervals predicted from GLMM.")}

# plot dispersal data

df_emmeans_zero <- as.data.frame(output_disp_zero_emmeans$emmeans)
ggplot(df_emmeans_zero, aes(x = Temp.treatment, y = prob, col = Temp.treatment)) +
  geom_point(size = 4) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0) +
  scale_x_discrete("Temperature treatment", limits = c("low", "opt", "high")) +
  scale_y_continuous("Dispersal count") +
  scale_color_manual(values = c("darkgreen", "red", "blue"), guide = "none") +
  theme_classic(base_size = 15)

df_emmeans_pos <- as.data.frame(output_disp_pos_emmeans$emmeans)
ggplot(df_emmeans_pos, aes(x = Temp.treatment, y = prob, col = Temp.treatment)) +
  geom_point(size = 4) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0) +
  scale_x_discrete("Temperature treatment", limits = c("low", "opt", "high")) +
  scale_y_continuous("Dispersal count") +
  scale_color_manual(values = c("darkgreen", "red", "blue"), guide = "none") +
  theme_classic(base_size = 15)


```

#### Results for main effect of temperature on dispersal for zero part
```{r dispersalresultsmaineffect_zero, echo = F}
# for zero part of dispersal
output_disp_zero_Tempeffect

```

#### Post-hoc pairwise contrasts: differences in dispersal between temperature treatments for zero part
```{r dispersalresultscontrasts_zero, echo = F}
# for zero part of dispersal
output_disp_zero_contrasts

```

#### Results for main effect of temperature on dispersal for positive part
```{r dispersalresultsmaineffect_pos, echo = F}
# for positive part of dispersal
output_disp_pos_Tempeffect

```

#### Post-hoc pairwise contrasts: differences in dispersal between temperature treatments for positive part
```{r dispersalresultscontrasts_pos, echo = F}
# for positive part of dispersal
output_disp_pos_contrasts

```

### Model Diagnostics

There was no evidence for lack of fit for either the fitness or the dispersal model.

#### Diagnostic plots for fitness data - zero part

```{r modeldiagnosticsfitness_zero, echo = F, fig.width = 8, fig.height = 7}
diagnostic_fitness_zero <- simulateResiduals(fittedModel = m_fitness_zero)
plot(diagnostic_fitness_zero)
```


#### Diagnostic plots for fitness data - positive part

```{r modeldiagnosticsfitness_pos, echo = F, fig.width = 8, fig.height = 7}
diagnostic_fitness_pos <- simulateResiduals(fittedModel = m_fitness_pos)
plot(diagnostic_fitness_pos)
```

#### Diagnostic plots for dispersal data - zero part

```{r modeldiagnosticsdispersal_zero, echo = F, fig.width = 8, fig.height = 7}
diagnostic_dispersal_zero <- simulateResiduals(fittedModel = m_disp_zero)
plot(diagnostic_dispersal_zero)
```


#### Diagnostic plots for dispersal data - positive part

```{r modeldiagnosticsdispersal_pos, echo = F, fig.width = 8, fig.height = 7}
diagnostic_dispersal_pos <- simulateResiduals(fittedModel = m_disp_pos)
plot(diagnostic_dispersal_pos)
```

```{r moderators, echo = F}

d_moderator <- data.frame(
  "Species" = paste(Genus, species),
  "Taxonomic group" = taxonomic.group,
  "Rearing.environment" = rearing.environment,
  "Competition.strength" = comp.strength,
  "Source" = source,
  "Habitat" = habitat,
  "Temperature.variation" = Tvariation,
  "Species mean body size" = species.body.size,
  "Passive.dispersal" = passive.dispersal,
  "Inbred.or.Mixed" = inbred,
  "Dispersal.assay.duration" = disp.assay.duration,
  "Fitness.proxy.type" = fitness.proxy.type
)

```

```{r writingoutputfiles, echo = F}
# fitness output for zero

write.table(output_fitness_zero_Tempeffect, paste(writing.path, "output_zero_TempMain_", Genus, ".", species, ".txt", sep = ""))

write.table(
  output_fitness_zero_summary$coefficients$cond,
  paste0(writing.path, "zero_summary_cond_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(output_fitness_zero_emmeans$emmeans, paste(writing.path, "output_zero_emmeans_", Genus, ".", species, ".txt", sep = ""))

write.table(output_fitness_zero_emmeans$contrasts, paste(writing.path, "output_zero_contrasts_", Genus, ".", species, ".txt", sep = ""))

# fitness output for pos

write.table(output_fitness_pos_Tempeffect, paste(writing.path, "output_pos_TempMain_", Genus, ".", species, ".txt", sep = ""))

write.table(
  output_fitness_pos_summary$coefficients$cond,
  paste0(writing.path, "pos_summary_cond_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(output_fitness_pos_emmeans$emmeans, paste(writing.path, "output_pos_emmeans_", Genus, ".", species, ".txt", sep = ""))

write.table(output_fitness_pos_emmeans$contrasts, paste(writing.path, "output_pos_contrasts_", Genus, ".", species, ".txt", sep = ""))

# dispersal output for zero part

write.table(output_disp_zero_Tempeffect, paste(writing.path, "output_dispersal_TempMain_", Genus, ".", species, ".txt", sep = ""))

write.table(
  output_disp_zero_summary$coefficients$cond,
  paste0(writing.path, "output_dispersal_Summary_cond_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(
  output_disp_zero_summary$coefficients$zi,
  paste0(writing.path, "output_dispersal_Summary_zi_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(output_disp_zero_emmeans$emmeans, paste(writing.path, "output_dispersal_emmeans_", Genus, ".", species, ".txt", sep = ""))

write.table(output_disp_zero_emmeans$contrasts, paste(writing.path, "output_dispersal_contrasts_", Genus, ".", species, ".txt", sep = ""))

# dispersal output for positive part

write.table(output_disp_pos_Tempeffect, paste(writing.path, "output_dispersal_TempMain_", Genus, ".", species, ".txt", sep = ""))

write.table(
  output_disp_pos_summary$coefficients$cond,
  paste0(writing.path, "output_dispersal_Summary_cond_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(
  output_disp_pos_summary$coefficients$zi,
  paste0(writing.path, "output_dispersal_Summary_zi_", Genus, ".", species, ".txt"),
  sep = "\t", row.names = TRUE, quote = FALSE
)

write.table(output_disp_pos_emmeans$emmeans, paste(writing.path, "output_dispersal_emmeans_", Genus, ".", species, ".txt", sep = ""))

write.table(output_disp_pos_emmeans$contrasts, paste(writing.path, "output_dispersal_contrasts_", Genus, ".", species, ".txt", sep = ""))


# moderator output

write.table(d_moderator, paste(writing.path, "moderators_", Genus, ".", species, ".txt", sep = ""))

```

